<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Closet stylized - Dise√±ador de Prendas</title>
    <!-- AGREGADO: Script para model-viewer -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #2d2d2d;
            min-height: 100vh;
            color: white;
        }

        .header {
            background: #8b1538;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .nav {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s ease;
        }

        .nav a:hover {
            opacity: 0.8;
        }

        .cart {
            background: white;
            color: #8b1538;
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: 600;
            position: relative;
        }

        .hero-section {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            padding: 80px 20px;
            text-align: center;
        }

        .hero-content h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .hero-content p {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 40px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .section-title {
            color: #8b1538;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            border-bottom: 3px solid #8b1538;
            padding-bottom: 10px;
            display: inline-block;
            width: 100%;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
            margin-top: 30px;
        }

        .design-area {
            background: #3a3a3a;
            border-radius: 15px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* MODIFICADO: Contenedor para cambiar entre 2D y 3D */
        .garment-display {
            position: relative;
            width: 300px;
            height: 400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            overflow: hidden;
        }

        /* MODIFICADO: SVG oculto por defecto */
        .garment-svg {
            width: 250px;
            height: 350px;
            transition: all 0.3s ease;
            display: none; /* Oculto para mostrar el 3D */
        }

        /* AGREGADO: Estilos para model-viewer */
        model-viewer {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            background: transparent;
        }

        /* AGREGADO: Controles de vista */
        .view-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
            display: flex;
            gap: 5px;
        }

        .view-btn {
            background: rgba(139, 21, 56, 0.8);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: background 0.3s;
        }

        .view-btn:hover {
            background: rgba(139, 21, 56, 1);
        }

        .view-btn.active {
            background: #8b1538;
            box-shadow: 0 0 10px rgba(139, 21, 56, 0.5);
        }

        .garment-info {
            text-align: center;
            background: #4a4a4a;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 100%;
            margin-bottom: 20px;
        }

        .garment-info h4 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: white;
        }

        .garment-info p {
            color: #ccc;
            font-size: 1rem;
        }

        .price-display {
            background: #8b1538;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .controls-panel {
            background: #3a3a3a;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .control-section {
            margin-bottom: 30px;
        }

        .control-section h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .garment-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .garment-btn {
            padding: 12px;
            border: 2px solid #666;
            background: #4a4a4a;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .garment-btn:hover {
            border-color: #8b1538;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 21, 56, 0.3);
        }

        .garment-btn.active {
            border-color: #8b1538;
            background: #8b1538;
            color: white;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        }

        .color-option.active {
            border-color: #8b1538;
            transform: scale(1.2);
            box-shadow: 0 0 0 3px rgba(139, 21, 56, 0.3);
        }

        .upload-area {
            border: 2px dashed #666;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            background: #4a4a4a;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            color: white;
        }

        .upload-area:hover {
            border-color: #8b1538;
            background: #555;
        }

        .upload-area.dragover {
            border-color: #8b1538;
            background: #555;
            transform: scale(1.02);
        }

        .upload-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #5a5a5a;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            border: 2px solid #666;
            transition: all 0.3s ease;
        }

        .upload-area:hover .upload-circle {
            border-color: #8b1538;
            background: #666;
        }

        .upload-text {
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
        }

        .upload-subtext {
            color: #ccc;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .products-preview {
            background: #3a3a3a;
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .product-card {
            background: #4a4a4a;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-card .sale-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #8b1538;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .product-image {
            width: 100%;
            height: 150px;
            background: #666;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .product-title {
            color: white;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .product-price {
            color: #8b1538;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .old-price {
            color: #999;
            text-decoration: line-through;
            margin-right: 10px;
        }

        .stars {
            color: #ffd700;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .hero-content h1 {
                font-size: 2rem;
            }

            .nav {
                gap: 15px;
            }

            .garment-selector {
                grid-template-columns: 1fr;
            }
        }

        .uploaded-design {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 60px;
            max-height: 60px;
            z-index: 10;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">Closet stylized</div>
            <nav class="nav">
                <a href="inicio.html">Inicio</a>
                    <a href="dise√±o.html">Dise√±ar</a>
                    <a href="galeria.html">Galer√≠a</a>
                    <a href="inicio_de_sesion.html">Iniciar Sesi√≥n</a>
                    <a href="carrito.html">carrito</a>
                    <a href="bordados.html">dise√±o bordado</a>
                    <a href="moodboard.html">colaboraciones</a>
                    <a href="restricciones.html">consejos de dise√±o</a>
                <div class="cart">üõí 0</div>
            </nav>
        </div>
    </div>

    <div class="hero-section">
        <div class="hero-content">
            <h1>Dise√±a con estilo</h1>
            <p>Crea tu propia ropa personalizada y √∫nica</p>
        </div>
    </div>
    
    <div class="container">
        <div class="section-title">Descubre Dise√±os de Nuestra Comunidad</div>
        
        <div class="main-content">
            <div class="design-area">
                <div class="garment-display" id="garmentDisplay">
                    <!-- AGREGADO: Controles de vista -->
                    <div class="view-controls">
                        <button class="view-btn active" onclick="switchView('3d')" id="btn3d">3D</button>
                    </div>

                    <!-- AGREGADO: Model Viewer 3D (tu prenda) -->
                    <model-viewer 
                        id="modelViewer"
                        crossorigin="anonymous"
                        src="prendas_CS/camisa_shirt/scene.gltf"
                        alt="Prenda 3D Personalizable"
                        auto-rotate
                        camera-controls
                        ar
                        ar-modes="webxr scene-viewer quick-look"
                        camera-orbit="0deg 90deg 2.5m"
                        min-camera-orbit="auto auto 1.5m"
                        max-camera-orbit="auto auto 4m"
                        loading="lazy"
                        reveal="auto"
                        exposure="1"
                        shadow-intensity="1"
                        environment-image="neutral">
                        
                        <!-- Indicador de carga -->
                        <div id="progressBar" slot="progress-bar" style="
                            display: block;
                            width: 33%;
                            height: 4px;
                            position: absolute;
                            left: 50%;
                            top: 50%;
                            transform: translate3d(-50%, -50%, 0);
                            border-radius: 25px;
                            background-color: rgba(139, 21, 56, 0.2);
                            border: 1px solid #8b1538;">
                            <div id="progressBarInner" style="
                                background-color: #8b1538;
                                width: 0%;
                                height: 100%;
                                border-radius: 25px;
                                transition: width 0.3s;"></div>
                        </div>

                        <!-- Mensaje de error -->
                        <div slot="error" style="
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background: rgba(255, 0, 0, 0.8);
                            color: white;
                            padding: 20px;
                            border-radius: 10px;
                            text-align: center;">
                            ‚ö†Ô∏è No se pudo cargar el modelo 3D
                        </div>
                    </model-viewer>

                    <!-- ORIGINAL: SVG 2D (ahora oculto por defecto) -->
                    <svg class="garment-svg" id="garmentSvg" viewBox="0 0 200 280" xmlns="http://www.w3.org/2000/svg">
                        <path id="garmentPath" d="M50 50 L50 80 L40 90 L40 260 L160 260 L160 90 L150 80 L150 50 L130 50 L130 40 L70 40 L70 50 Z" fill="#FF6B6B" stroke="#333" stroke-width="2"/>
                        <circle cx="85" cy="60" r="3" fill="#333" opacity="0.3"/>
                        <circle cx="115" cy="60" r="3" fill="#333" opacity="0.3"/>
                    </svg>
                </div>
                
                <div class="garment-info">
                    <h4 id="garmentTitle">üëï Camiseta Personalizada</h4>
                    <p id="garmentSpecs">Material: Algod√≥n | Talla: M | Color: Coral</p>
                </div>

                <div class="price-display">
                    $32.000
                </div>

                <div class="upload-area" id="uploadArea">
                    <div class="upload-circle pulse">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="#ccc">
                            <path d="M0.5 10H2.5V15H18.5V10H20.5V15C20.5 16.11 19.61 17 18.5 17H2.5C1.96957 17 1.46086 16.7893 1.08579 16.4142C0.710714 16.0391 0.5 15.5304 0.5 15V10ZM10.5 0L4.96 5.46L6.38 6.88L9.5 3.75V13H11.5V3.75L14.63 6.88L16.05 5.45L10.5 0Z"/>
                        </svg>
                    </div>
                    <div class="upload-text">Sube o suelta tu dise√±o aqu√≠</div>
                    <div class="upload-subtext">Formatos: PNG, JPG, SVG (M√°x. 5MB)</div>
                    <input type="file" class="file-input" id="fileInput" accept="image/*">
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="control-section">
                    <h3>üëî Tipo de Prenda</h3>
                    <div class="garment-selector">
                        <button class="garment-btn active" data-garment="camiseta">üëï Camiseta</button>
                        <button class="garment-btn" data-garment="polo">üëî Polo</button>
                        <button class="garment-btn" data-garment="camisa">üëî Camisa</button>
                        <button class="garment-btn" data-garment="buzo">üß• Buzo</button>
                        <button class="garment-btn" data-garment="chaqueta">üß• Chaqueta</button>
                        <button class="garment-btn" data-garment="pantalon">üëñ Pantal√≥n</button>
                        <button class="garment-btn" data-garment="short">ü©≥ Short</button>
                        <button class="garment-btn" data-garment="falda">üëó Falda</button>
                    </div>
                </div>
                
                <div class="control-section">
                    <h3>üé® Color de la Prenda</h3>
                    <div class="color-palette">
                        <div class="color-option active" data-color="#FF6B6B" style="background-color: #FF6B6B;" title="Coral"></div>
                        <div class="color-option" data-color="#4ECDC4" style="background-color: #4ECDC4;" title="Turquesa"></div>
                        <div class="color-option" data-color="#45B7D1" style="background-color: #45B7D1;" title="Azul Cielo"></div>
                        <div class="color-option" data-color="#96CEB4" style="background-color: #96CEB4;" title="Verde Menta"></div>
                        <div class="color-option" data-color="#FFEAA7" style="background-color: #FFEAA7;" title="Amarillo Suave"></div>
                        <div class="color-option" data-color="#DDA0DD" style="background-color: #DDA0DD;" title="Lavanda"></div>
                        <div class="color-option" data-color="#FFB3BA" style="background-color: #FFB3BA;" title="Rosa Pastel"></div>
                        <div class="color-option" data-color="#FFD93D" style="background-color: #FFD93D;" title="Amarillo Brillante"></div>
                        <div class="color-option" data-color="#6BCF7F" style="background-color: #6BCF7F;" title="Verde Claro"></div>
                        <div class="color-option" data-color="#4D4D4D" style="background-color: #4D4D4D;" title="Gris Oscuro"></div>
                        <div class="color-option" data-color="#000000" style="background-color: #000000;" title="Negro"></div>
                        <div class="color-option" data-color="#FFFFFF" style="background-color: #FFFFFF; border: 1px solid #666;" title="Blanco"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="products-preview">
            <h3 style="color: white; margin-bottom: 20px; text-align: center;">Productos Destacados</h3>
            <div class="products-grid">
                <div class="product-card">
                    <div class="product-image">üëï</div>
                    <div class="product-title">Camiseta Urban</div>
                    <div class="product-price">$32.000</div>
                    <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                </div>
                <div class="product-card">
                    <div class="sale-badge">Sale</div>
                    <div class="product-image">üß•</div>
                    <div class="product-title">Chaqueta Premium</div>
                    <div class="product-price">
                        <span class="old-price">$95.000</span>
                        $85.000
                    </div>
                    <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                </div>
                <div class="product-card">
                    <div class="product-image">üëñ</div>
                    <div class="product-title">Pantal√≥n Casual</div>
                    <div class="product-price">
                        <span class="old-price">$50.000</span>
                        $42.000
                    </div>
                    <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                </div>
                <div class="product-card">
                    <div class="product-image">üß•</div>
                    <div class="product-title">Buso Deportivo</div>
                    <div class="product-price">$45.000</div>
                    <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // AGREGADO: Variables para control de vista
        let currentView = '3d';
        
        // Definir las formas SVG para cada prenda
        const garmentShapes = {
            camiseta: {
                path: "M50 50 L50 80 L40 90 L40 260 L160 260 L160 90 L150 80 L150 50 L130 50 L130 40 L70 40 L70 50 Z",
                title: "üëï Camiseta Personalizada",
                details: '<circle cx="85" cy="60" r="3" fill="#333" opacity="0.3"/><circle cx="115" cy="60" r="3" fill="#333" opacity="0.3"/>',
                price: "$32.000",
                model: "prendas_CS/camisa_shirt/scene.gltf" // AGREGADO: Ruta del modelo 3D
            },
            polo: {
                path: "M50 50 L50 80 L40 90 L40 260 L160 260 L160 90 L150 80 L150 50 L130 50 L130 35 L70 35 L70 50 Z",
                title: "üëî Polo Personalizado",
                details: '<rect x="85" y="45" width="30" height="25" fill="#333" opacity="0.2" rx="3"/><circle cx="90" cy="52" r="2" fill="#333" opacity="0.4"/><circle cx="110" cy="52" r="2" fill="#333" opacity="0.4"/>',
                price: "$38.000",
                model: "polo/scene.gltf"
            },
            camisa: {
                path: "M45 45 L45 75 L35 85 L35 270 L165 270 L165 85 L155 75 L155 45 L135 45 L135 30 L65 30 L65 45 Z",
                title: "üëî Camisa Personalizada",
                details: '<rect x="75" y="40" width="50" height="30" fill="#333" opacity="0.1" rx="5"/><circle cx="85" cy="50" r="2" fill="#333" opacity="0.4"/><circle cx="100" cy="50" r="2" fill="#333" opacity="0.4"/><circle cx="115" cy="50" r="2" fill="#333" opacity="0.4"/>',
                price: "$48.000",
                model: "camisa_shirt/scene.gltf"
            },
            buzo: {
                path: "M45 55 L45 85 L35 95 L35 275 L165 275 L165 95 L155 85 L155 55 L140 55 L140 35 L125 35 L125 25 L75 25 L75 35 L60 35 L60 55 Z",
                title: "üß• Buzo Personalizado",
                details: '<rect x="75" y="30" width="50" height="15" fill="#333" opacity="0.2" rx="7"/><circle cx="90" cy="50" r="3" fill="#333" opacity="0.3"/><circle cx="110" cy="50" r="3" fill="#333" opacity="0.3"/>',
                price: "$45.000",
                model: "buzo/scene.gltf"
            },
            chaqueta: {
                path: "M40 50 L40 80 L30 90 L30 280 L80 280 L80 270 L120 270 L120 280 L170 280 L170 90 L160 80 L160 50 L145 50 L145 30 L55 30 L55 50 Z",
                title: "üß• Chaqueta Personalizada",
                details: '<rect x="70" y="35" width="60" height="25" fill="#333" opacity="0.15" rx="5"/><circle cx="75" cy="45" r="2" fill="#333" opacity="0.5"/><circle cx="85" cy="45" r="2" fill="#333" opacity="0.5"/><circle cx="95" cy="45" r="2" fill="#333" opacity="0.5"/>',
                price: "$85.000",
                model: "prendas_CS/metaretail_chaqueta_roja_con_percha/scene.gltf"
            },
            pantalon: {
                path: "M60 40 L60 150 L55 150 L55 270 L85 270 L85 150 L115 150 L115 270 L145 270 L145 150 L140 150 L140 40 Z",
                title: "üëñ Pantal√≥n Personalizado",
                details: '<rect x="70" y="45" width="60" height="20" fill="#333" opacity="0.1" rx="3"/><circle cx="90" cy="55" r="2" fill="#333" opacity="0.4"/><circle cx="110" cy="55" r="2" fill="#333" opacity="0.4"/>',
                price: "$42.000",
                model: "prendas_CS/pantalon_gris_nexus_tours/scene.gltf"
            },
            short: {
                path: "M60 40 L60 120 L55 120 L55 180 L85 180 L85 120 L115 120 L115 180 L145 180 L145 120 L140 120 L140 40 Z",
                title: "ü©≥ Short Personalizado",
                details: '<rect x="70" y="45" width="60" height="15" fill="#333" opacity="0.1" rx="3"/><circle cx="85" cy="52" r="2" fill="#333" opacity="0.4"/><circle cx="115" cy="52" r="2" fill="#333" opacity="0.4"/>',
                price: "$28.000",
                model: "prendas_CS/man_shorts/scene.gltf"
            },
            falda: {
                path: "M70 40 L70 100 L50 180 L150 180 L130 100 L130 40 Z",
                title: "üëó Falda Personalizada",
                details: '<rect x="80" y="45" width="40" height="15" fill="#333" opacity="0.1" rx="3"/><circle cx="90" cy="52" r="2" fill="#333" opacity="0.3"/><circle cx="110" cy="52" r="2" fill="#333" opacity="0.3"/>',
                price: "$35.000",
                model: "prendas_CS/falda-_skirt/scene.gltf"
            }
        };

        // AGREGADO: Mapeo de colores para modelo 3D
        const colorMapping = {
            '#FF6B6B': { name: 'Coral', rgb: [1.0, 0.42, 0.42] },
            '#4ECDC4': { name: 'Turquesa', rgb: [0.31, 0.80, 0.77] },
            '#45B7D1': { name: 'Azul Cielo', rgb: [0.27, 0.72, 0.82] },
            '#96CEB4': { name: 'Verde Menta', rgb: [0.59, 0.81, 0.71] },
            '#FFEAA7': { name: 'Amarillo Suave', rgb: [1.0, 0.92, 0.65] },
            '#DDA0DD': { name: 'Lavanda', rgb: [0.87, 0.63, 0.87] },
            '#FFB3BA': { name: 'Rosa Pastel', rgb: [1.0, 0.70, 0.73] },
            '#FFD93D': { name: 'Amarillo Brillante', rgb: [1.0, 0.85, 0.24] },
            '#6BCF7F': { name: 'Verde Claro', rgb: [0.42, 0.81, 0.50] },
            '#4D4D4D': { name: 'Gris Oscuro', rgb: [0.30, 0.30, 0.30] },
            '#000000': { name: 'Negro', rgb: [0.05, 0.05, 0.05] },
            '#FFFFFF': { name: 'Blanco', rgb: [0.95, 0.95, 0.95] }
        };

        let currentGarment = 'camiseta';
        let currentColor = '#FF6B6B';
        let uploadedDesign = null;

        // Elementos del DOM
        const garmentSvg = document.getElementById('garmentSvg');
        const garmentPath = document.getElementById('garmentPath');
        const garmentTitle = document.getElementById('garmentTitle');
        const garmentSpecs = document.getElementById('garmentSpecs');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const priceDisplay = document.querySelector('.price-display');
        const modelViewer = document.getElementById('modelViewer');

        // AGREGADO: Funci√≥n para cambiar entre vista 2D y 3D
        function switchView(viewType) {
            const btn3d = document.getElementById('btn3d');
            const btn2d = document.getElementById('btn2d');
            
            if (viewType === '3d') {
                currentView = '3d';
                modelViewer.style.display = 'block';
                garmentSvg.style.display = 'none';
                btn3d.classList.add('active');
                btn2d.classList.remove('active');
            } else {
                currentView = '2d';
                modelViewer.style.display = 'none';
                garmentSvg.style.display = 'block';
                btn3d.classList.remove('active');
                btn2d.classList.add('active');
            }
        }

        // AGREGADO: Funci√≥n para cargar modelo 3D
        function load3DModel(garmentType) {
            const garment = garmentShapes[garmentType];
            if (garment && garment.model) {
                const progressBar = document.getElementById('progressBar');
                const progressBarInner = document.getElementById('progressBarInner');
                
                // Mostrar y resetear el indicador de carga
                progressBar.style.display = 'block';
                progressBarInner.style.width = '0%';
                
                modelViewer.src = garment.model;
                console.log(`Cargando modelo 3D: ${garment.model}`);
                
                // Aplicar color actual al nuevo modelo cuando se cargue
                modelViewer.addEventListener('load', function() {
                    update3DColor(currentColor);
                    progressBar.style.display = 'none';
                }, { once: true });
            }
        }

        // AGREGADO: Funci√≥n para actualizar color del modelo 3D
        function update3DColor(colorHex) {
            if (modelViewer.model && colorMapping[colorHex]) {
                const [r, g, b] = colorMapping[colorHex].rgb;
                
                try {
                    // Buscar y modificar todos los materiales del modelo
                    modelViewer.model.materials.forEach(material => {
                        if (material.pbrMetallicRoughness) {
                            material.pbrMetallicRoughness.setBaseColorFactor([r, g, b, 1.0]);
                        }
                    });
                    console.log(`Color 3D actualizado a: ${colorMapping[colorHex].name} [${r}, ${g}, ${b}]`);
                } catch (error) {
                    console.log('Modelo a√∫n no cargado completamente, aplicando color m√°s tarde...');
                }
            }
        }

        // Funci√≥n para actualizar la prenda
        function updateGarment(garmentType) {
            const garment = garmentShapes[garmentType];
            
            // Actualizar SVG 2D
            garmentPath.setAttribute('d', garment.path);
            garmentPath.setAttribute('fill', currentColor);
            
            // Actualizar detalles SVG
            const existingDetails = garmentSvg.querySelector('.garment-details');
            if (existingDetails) {
                existingDetails.remove();
            }
            
            const detailsGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            detailsGroup.classList.add('garment-details');
            detailsGroup.innerHTML = garment.details;
            garmentSvg.appendChild(detailsGroup);
            
            // AGREGADO: Cargar modelo 3D correspondiente
            load3DModel(garmentType);
            
            // Actualizar informaci√≥n
            garmentTitle.textContent = garment.title;
            priceDisplay.textContent = garment.price;
            updateSpecs();
        }

        // Funci√≥n para actualizar especificaciones
        function updateSpecs() {
            const colorName = colorMapping[currentColor]?.name || 'Personalizado';
            garmentSpecs.textContent = `Material: Algod√≥n | Talla: M | Color: ${colorName}`;
        }

        // Event listeners para selecci√≥n de prenda
        document.querySelectorAll('.garment-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.garment-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentGarment = btn.dataset.garment;
                updateGarment(currentGarment);
            });
        });

        // Event listeners para selecci√≥n de color
        document.querySelectorAll('.color-option').forEach(colorBtn => {
            colorBtn.addEventListener('click', () => {
                document.querySelectorAll('.color-option').forEach(c => c.classList.remove('active'));
                colorBtn.classList.add('active');
                currentColor = colorBtn.dataset.color;
                
                // Actualizar color en SVG 2D
                garmentPath.setAttribute('fill', currentColor);
                
                // AGREGADO: Actualizar color en modelo 3D
                update3DColor(currentColor);
                
                updateSpecs();
            });
        });

        // Funcionalidad de carga de archivos
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                handleFileUpload(fileInput.files[0]);
            }
        });

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                handleFileUpload(fileInput.files[0]);
            }
        });

        function handleFileUpload(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (uploadedDesign) {
                        uploadedDesign.remove();
                    }
                    uploadedDesign = document.createElement('img');
                    uploadedDesign.src = e.target.result;
                    uploadedDesign.classList.add('uploaded-design');
                    
                    // Agregar el dise√±o seg√∫n la vista actual
                    if (currentView === '2d') {
                        garmentSvg.appendChild(uploadedDesign);
                    } else {
                        // En vista 3D, mostrar como overlay
                        const overlay = document.createElement('div');
                        overlay.style.cssText = `
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            z-index: 100;
                            opacity: 0.8;
                            pointer-events: none;
                        `;
                        overlay.appendChild(uploadedDesign);
                        document.getElementById('garmentDisplay').appendChild(overlay);
                    }
                };
                reader.readAsDataURL(file);
            } else {
                alert('Por favor, sube un archivo de imagen v√°lido.');
            }
        }

        // AGREGADO: Inicializaci√≥n del modelo 3D
        window.addEventListener('load', function() {
            const progressBar = document.getElementById('progressBar');
            const progressBarInner = document.getElementById('progressBarInner');

            // Manejar el progreso de carga
            modelViewer.addEventListener('progress', (event) => {
                const progress = event.detail.totalProgress * 100;
                progressBarInner.style.width = progress + '%';
            });

            // Ocultar el indicador de carga cuando el modelo est√© listo
            modelViewer.addEventListener('load', function() {
                progressBar.style.display = 'none';
                update3DColor(currentColor);
            });

            // Tambi√©n ocultar el indicador si hay un error
            modelViewer.addEventListener('error', function() {
                progressBar.style.display = 'none';
            });

            // Cargar el modelo inicial
            load3DModel(currentGarment);
        });
    </script>
</body>
</html>